"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.controlFreePanel=exports.createFreePanel=void 0;var _mainPanel=require("./mainPanel.vue"),_mainPanel2=_interopRequireDefault(_mainPanel);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function transit(){var t=this,n=this;this.thisContainer={},this.defaultFreeStyle={},this.defaultFreeData={},this.defaultFreeConfig={},this.componentsName=[],this.currentControlId="",this.currentSwitchCallback={},this.currentChangeCallback={},this.groupChangeCallback={},this.eventChangeCallback={},this.modifyRecord=[],this.currentRecordIndex=-1,this.triggerLock=!0,this.groupBarrel={},this.groupState=!1,this.groupTemporaryContainer=null,this.thisHook=function(e,t){n.thisContainer[e]||(n.thisContainer[e]=t)},this.useThis=function(e){return n.thisContainer[e]},this.removeThis=function(e){try{n.thisContainer[e]&&delete n.thisContainer[e]}catch(e){console.error(e)}},this.addDefaultFreeConfig=function(e,t){t.props&&(t.props.freeStyle&&t.props.freeStyle.default&&!n.defaultFreeStyle[e]&&(n.defaultFreeStyle[e]=t.props.freeStyle.default()),t.props.freeData&&t.props.freeData.default&&!n.defaultFreeData[e]&&(n.defaultFreeData[e]=t.props.freeData.default()),t.props.freeConfig&&t.props.freeConfig.default&&!n.defaultFreeConfig[e]&&(n.defaultFreeConfig[e]=t.props.freeConfig.default()))},this.reset=function(e){t.thisContainer.mainPanel&&Object.assign(t.thisContainer.mainPanel.$data,t.thisContainer.mainPanel.$options.data()),t.currentControlId="",t.modifyRecord=[],t.currentRecordIndex=-1,t.groupBarrel={},t.groupState=!1,t.groupTemporaryContainer=null,e&&(t.currentSwitchCallback={},t.currentChangeCallback={})}}var createFreePanel=exports.createFreePanel=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=new transit;this.freeTransit=o,this.mainPanel=_mainPanel2.default;function n(e,t){var n;t.created?(n=t.created,t.created=function(){o.thisHook(e||this.id,this),n.call(this)}):t.created=function(){o.thisHook(e||this.id,this)},t.beforeDestroy&&t.beforeDestroy.length||(t.beforeDestroy=[]),t.beforeDestroy[t.beforeDestroy.length]=function(){o.removeThis(e||this.id,this)}}n("mainPanel",this.mainPanel),o.addDefaultFreeConfig("mainPanel",this.mainPanel),e.components&&e.components.length&&e.components.map(function(e){return n(void 0,e.component),o.addDefaultFreeConfig(e.name,e.component),o.componentsName.push(e.name),e.component.props||(e.component.props={}),e.component.props.id={type:null},e.component.props.positioning={type:null},t.mainPanel.components||(t.mainPanel.components={}),t.mainPanel.components[e.name]=e.component,e}),this.component=function(){return new Promise(function(e){e(t.mainPanel)})}},controlFreePanel=exports.controlFreePanel=function(v){var a=this;function i(t){try{var n=JSON.parse(JSON.stringify(v.groupBarrel)),o=JSON.parse(JSON.stringify(v.groupTemporaryContainer)),r=v.useThis("mainPanel").componentList.map(function(e){return e.id});Object.keys(n).forEach(function(t){Object.keys(n[t].gather).forEach(function(e){~r.indexOf(e)||delete n[t].gather[e]})}),Object.keys(v.groupChangeCallback).forEach(function(e){v.groupChangeCallback[e](t,n,o)})}catch(e){"true"!==e.message&&!0!==e.message&&console.error(e)}}function c(t){try{var e=v.useThis("mainPanel"),e=JSON.parse(JSON.stringify(e.eventGather));delete e.touchPeak,delete e.touchGround;var n=Object.assign({},t.eventGather,e);Object.keys(v.eventChangeCallback).forEach(function(e){v.eventChangeCallback[e](t,n)})}catch(e){"true"!==e.message&&!0!==e.message&&console.error(e)}}function s(e,t){var n,o,r=1<arguments.length&&void 0!==t?t:16,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[],r=r||i.length;if(e)for(n=0;n<e;n++)a[n]=i[0|Math.random()*r];else for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",n=0;n<32;n++)a[n]||(o=0|16*Math.random(),a[n]=i[19==n?3&o|8:o]);return a.join("")}function n(t,n,o,r){if(v.currentControlId&&v.triggerLock){v.triggerLock=!1;var e=v.useThis("mainPanel");try{"mainPanel"===v.currentControlId?e[t][n]=o:e.componentList.forEach(function(e){if(e.id===v.currentControlId){if(!("positioning"==t?~["left","top","zIndex"].indexOf(n)&&e.positioning:~Object.keys(v["freeStyle"==t?"defaultFreeStyle":"freeData"==t?"defaultFreeData":"freeConfig"==t?"defaultFreeConfig":""][e.name]).indexOf(n)))throw new Error("修改的配置属性不在修改范围！");throw r&&L({id:e.id,name:e.name,behavior:"updata",type:t,key:n,newData:_defineProperty({},t,_defineProperty({},n,o)),oldData:_defineProperty({},t,_defineProperty({},n,e[t][n]))}),e[t]=Object.assign({},e[t],_defineProperty({},n,o)),new Error(!0)}})}catch(e){"true"!==e.message&&!0!==e.message&&console.error(e)}e.$nextTick(function(){v.triggerLock=!0})}}function L(e){v.modifyRecord[v.currentRecordIndex+1]&&v.modifyRecord.splice(v.currentRecordIndex+1,v.modifyRecord.length-1);var t=JSON.parse(JSON.stringify(e));v.modifyRecord.push(t),v.currentRecordIndex++,Object.keys(v.currentChangeCallback).forEach(function(e){v.currentChangeCallback[e](t,v.currentRecordIndex,v.modifyRecord)})}function e(e){if(v.triggerLock){v.triggerLock=!1;var n=v.useThis("mainPanel"),o=v.modifyRecord[v.currentRecordIndex],r="rollBack"==e?"oldData":"nextStep"==e?"newData":"";try{o&&(v.currentControlId="",Object.keys(v.currentSwitchCallback).forEach(function(e){v.currentSwitchCallback[e](null)}),"add"==o.behavior&&o[r]||"del"==o.behavior&&o[r]?(n.componentList.push(o[r]),o[r].positioning&&n.$nextTick(function(){v.currentControlId=o.id,Object.keys(v.currentSwitchCallback).forEach(function(e){v.currentSwitchCallback[e](v.useThis(o.id)||null)}),l(o.id),null!=o[r].freeStyle.width&&null!=o[r].freeStyle.height&&(u(o.id,"topRightAngle"),u(o.id,"topLeftAngle"),u(o.id,"bottomRightAngle"),u(o.id,"bottomLeftAngle"))})):"groupMobile"==o.type?n.componentList.forEach(function(e,t){~o.id.indexOf(e.id)&&(n.componentList[t].positioning=o[r].positioning[e.id])}):n.componentList.forEach(function(e,t){if(e.id===o.id)throw"add"==o.behavior||"del"==o.behavior?(n.componentList.splice(t,1),v.removeThis(e.id)):"updata"==o.behavior&&("dragAndDrop"==o.type?n.componentList[t].positioning=o[r].positioning:"mouseZoom"==o.type?(n.componentList[t].freeStyle=o[r].freeStyle,n.componentList[t].positioning=o[r].positioning):n.componentList[t][o.type][o.key]=o[r][o.type][o.key],n.$nextTick(function(){v.currentControlId=o.id,Object.keys(v.currentSwitchCallback).forEach(function(e){v.currentSwitchCallback[e](v.useThis(o.id)||null)})})),new Error(!0)}))}catch(e){"true"!==e.message&&!0!==e.message&&console.error(e)}n.$nextTick(function(){v.triggerLock=!0,i()})}}function l(o){var r,i,a,c,s,l=v.useThis("mainPanel"),e=l.$refs[o][0],u=0,p=0,f={},h={},g=0,m=0,d=!1,y=!1;function t(e){var t,n;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,d&&(m=g=p=u=0,d=!1,document.onmouseup=null,window.onmousemove=null,y&&(y=!1,s?(e=Object.keys(a),t={positioning:{}},n={positioning:{}},c.map(function(e){t.positioning[l.componentList[e].id]=l.componentList[e].positioning}),e.map(function(e){n.positioning[a[e].id]=a[e].positioning}),L({id:e,behavior:"updata",type:"groupMobile",newData:t,oldData:n})):L({id:r.id,name:r.name,behavior:"updata",type:"dragAndDrop",newData:{positioning:l.componentList[i].positioning},oldData:{positioning:r.positioning}}),s=c=a=i=r=null,f={},m=g=p=u=0,y=d=!(h={})))}function n(e){var o,r,t;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,0!=d&&(o=e.clientX,r=e.clientY,s?c.forEach(function(e){var t=o-(g-f[e]),n=r-(m-h[e]);l.componentList[e].positioning.left=t+"px",l.componentList[e].positioning.top=n+"px"}):(t=o-(g-u),e=r-(m-p),l.componentList[i].positioning.left=t+"px",l.componentList[i].positioning.top=e+"px"),y=!0)}e.onmousedown=function(e){if(v.groupState)return;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0;try{throw l.componentList.forEach(function(t,e){if(t.id===o){if(t.groupMember)if(v.groupBarrel[t.groupId]){s=!0;var n=Object.keys(v.groupBarrel[t.groupId].gather).map(function(e){return v.groupBarrel[t.groupId].gather[e].id});try{a={},c=[],l.componentList.forEach(function(e,t){~n.indexOf(e.id)&&(a[e.id]=JSON.parse(JSON.stringify(e)),f[t]=Number(e.positioning.left.replace(/px/,"")),h[t]=Number(e.positioning.top.replace(/px/,"")),c.push(t))})}catch(e){console.error(e)}}else delete l.componentList[e].groupMember,delete l.componentList[e].groupId,s=!1,r=JSON.parse(JSON.stringify(t)),i=e,u=Number(t.positioning.left.replace(/px/,"")),p=Number(t.positioning.top.replace(/px/,""));else s=!1,r=JSON.parse(JSON.stringify(t)),i=e,u=Number(t.positioning.left.replace(/px/,"")),p=Number(t.positioning.top.replace(/px/,""));throw new Error(!0)}}),new Error("未找到需要注册拖拽事件的节点")}catch(e){if("true"!==e.message&&!0!==e.message)return void console.error(e)}g=e.clientX,m=e.clientY,d=!0,document.onmouseup=t,window.onmousemove=n}}function u(n,o){var r,i,a,c=v.useThis("mainPanel"),t=c.$refs[n][0],e=c.$refs[o+"_"+n][0],s=0,l=0,u=0,p=0,f=null,h=null,g=!1,m=!1;function d(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,g&&(l=s=p=u=0,h=f=null,g=!1,document.onmouseup=null,window.onmousemove=null,m&&(m=!1,L({id:r.id,name:r.name,behavior:"updata",type:"mouseZoom",newData:{positioning:c.componentList[i].positioning,freeStyle:c.componentList[i].freeStyle},oldData:{positioning:r.positioning,freeStyle:r.freeStyle}})))}function y(e){var t,n;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,0!=g&&(null==f&&(f=e.clientX),null==h&&(h=e.clientY),t=e.clientX-f,n=e.clientY-h,e=JSON.parse(JSON.stringify(c.componentList[i].freeStyle)),"topLeftAngle"==o?(e.width&&(e.width=C(-1*t+s,function(){a&&(c.componentList[i].positioning.left=t+u+"px")})+"px"),e.height&&(e.height=b(-1*n+l,function(){a&&(c.componentList[i].positioning.top=n+p+"px")})+"px")):"bottomLeftAngle"==o?(e.width&&(e.width=C(-1*t+s,function(){a&&(c.componentList[i].positioning.left=t+u+"px")})+"px"),e.height&&(e.height=b(n+l)+"px")):"topRightAngle"==o?(e.width&&(e.width=C(t+s)+"px"),e.height&&(e.height=b(-1*n+l,function(){a&&(c.componentList[i].positioning.top=n+p+"px")})+"px")):"bottomRightAngle"==o&&(e.width&&(e.width=C(t+s)+"px"),e.height&&(e.height=b(n+l)+"px")),c.componentList[i].freeStyle=e,m=!0)}function C(e,t){return 10<e?(t&&t(),e):10}function b(e,t){return 10<e?(t&&t(),e):10}e.onmousedown=function(e){if(v.groupState)return;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0;try{throw c.componentList.forEach(function(e,t){if(e.id===n)throw r=JSON.parse(JSON.stringify(e)),i=t,a=!!e.positioning,new Error(!0)}),new Error("未找到需要注册拖拽事件的节点")}catch(e){if("true"!==e.message&&!0!==e.message)return void console.error(e)}s=t.offsetWidth,l=t.offsetHeight,u=t.offsetLeft,p=t.offsetTop,g=!0,document.onmouseup=d,window.onmousemove=y}}this.useThis=function(e){return v.useThis(e)},this.setCurrentControl=function(t){var n;v.groupState?function(e){for(var t=v.useThis("mainPanel"),n=0;n<t.componentList.length;n++)if(e==t.componentList[n].id){if(t.componentList[n].groupMember)if(t.componentList[n].groupId==v.groupTemporaryContainer.groupId)delete t.componentList[n].groupMember,delete t.componentList[n].groupId,delete v.groupTemporaryContainer.gather[e];else try{throw new Error("该组件已经加入其他分组，一个组件只能加入一个分组")}catch(e){console.log(e)}else t.componentList[n].groupMember=!0,t.componentList[n].groupId=v.groupTemporaryContainer.groupId,v.groupTemporaryContainer.gather[e]={id:t.componentList[n].id,label:t.componentList[n].name,serialNumber:function(){var e=Object.keys(v.groupTemporaryContainer.gather).map(function(e){return v.groupTemporaryContainer.gather[e].serialNumber});return e.length?Math.max.apply(Math,_toConsumableArray(e))+1+"":"0"}()};break}i(v.groupBarrel[v.groupTemporaryContainer.groupId])}(t):v.triggerLock&&(n=v.useThis("mainPanel"),v.triggerLock=!1,v.currentControlId!==t&&(v.currentControlId=t,Object.keys(v.currentSwitchCallback).forEach(function(e){v.currentSwitchCallback[e](t&&v.useThis(t)||null)})),i(),n.$nextTick(function(){try{n.componentList.map(function(e,t){if(e.id==v.currentControlId)throw c(n.componentList[t]),new Error(!0)}),"mainPanel"==v.currentControlId&&c(n)}catch(e){"true"!==e.message&&!0!==e.message&&console.error(e)}v.triggerLock=!0}))},this.listeningCurrentSwitch=function(e){var t=s();return v.currentSwitchCallback[t]=e,function(){delete v.currentSwitchCallback[t]}},this.listeningCurrentChange=function(e){var t=s();return v.currentChangeCallback[t]=e,function(){delete v.currentChangeCallback[t]}},this.addComponent=function(e,t,n){if(~v.componentsName.indexOf(e)){if(1!=v.groupState){var o=v.useThis("mainPanel");if(o.componentList&&v.triggerLock){v.triggerLock=!1;var r=s(),i=n||{id:r,name:e,freeStyle:v.defaultFreeStyle[e]||{},freeData:v.defaultFreeData[e]||{},freeConfig:v.defaultFreeConfig[e]||{},eventGather:{},bindEvent:{}};t&&Object.assign(i,{positioning:{position:"absolute",left:"0px",top:(o.scrollTop||0)+"px",zIndex:1}}),o.componentList.push(i),L({id:r,name:e,behavior:"add",newData:i,oldData:null}),o.$nextTick(function(){a.setCurrentControl(r),t&&l(r),t&&null!=i.freeStyle.width&&null!=i.freeStyle.height&&(u(r,"topRightAngle"),u(r,"topLeftAngle"),u(r,"bottomRightAngle"),u(r,"bottomLeftAngle")),v.triggerLock=!0})}else try{throw new Error("页面组件没有componentList组件容器！")}catch(e){console.error(e)}}}else try{throw new Error(e+":组件不存在！")}catch(e){console.error(e)}},this.removeComponent=function(n){if(1!=v.groupState&&(n||v.currentControlId)&&v.triggerLock){v.triggerLock=!1;var o=v.useThis("mainPanel");try{o.componentList&&o.componentList.forEach(function(e,t){if(e.id==(n||v.currentControlId)){v.removeThis(v.currentControlId);t=o.componentList.splice(t,1);throw L({id:t[0].id,name:t[0].name,behavior:"del",newData:null,oldData:t[0]}),new Error(!0)}})}catch(e){"true"!==e.message&&!0!==e.message&&console.error(e)}o.$nextTick(function(){v.triggerLock=!0,a.setCurrentControl("")})}},this.setStyle=function(e,t){n("freeStyle",e,t,!(2<arguments.length&&void 0!==arguments[2])||arguments[2])},this.setData=function(e,t){n("freeData",e,t,!(2<arguments.length&&void 0!==arguments[2])||arguments[2])},this.setConfig=function(e,t){n("freeConfig",e,t,!(2<arguments.length&&void 0!==arguments[2])||arguments[2])},this.setPositioning=function(e,t){n("positioning",e,t,!(2<arguments.length&&void 0!==arguments[2])||arguments[2])},this.echoComponent=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a.resetFreePanel();var t=v.useThis("mainPanel"),n=e.elements||[];if(v.groupBarrel=e.groupBarrel||{},t.componentList&&v.triggerLock)try{v.triggerLock=!1,t.componentList=[],Object.keys(v.thisContainer).forEach(function(e){"mainPanel"!==e&&v.removeThis(e)}),t.$nextTick(function(){t.componentList=n,t.$nextTick(function(){i(),t.componentList.forEach(function(e){e.positioning&&l(e.id),e.positioning&&null!=e.freeStyle.width&&null!=e.freeStyle.height&&(u(e.id,"topRightAngle"),u(e.id,"topLeftAngle"),u(e.id,"bottomRightAngle"),u(e.id,"bottomLeftAngle"))}),v.triggerLock=!0})})}catch(e){v.triggerLock=!0}else try{throw new Error("页面组件没有componentList组件容器！")}catch(e){console.error(e)}},this.createGroup=function(){var e=s();v.groupBarrel[e]={groupId:e,label:"newGroup",gather:{},serialNumber:(e=Object.keys(v.groupBarrel).map(function(e){return v.groupBarrel[e].serialNumber})).length?Math.max.apply(Math,_toConsumableArray(e))+1+"":"0"},i()},this.setGroup=function(e){var t,n;0==v.groupState&&(t=v.useThis("mainPanel"),(n=v.groupBarrel[e])&&(v.currentControlId="",Object.keys(v.currentSwitchCallback).forEach(function(e){v.currentSwitchCallback[e](null)}),t.$nextTick(function(){v.groupState=!0,t.groupState=!0,v.groupTemporaryContainer=n,i(v.groupTemporaryContainer)})))},this.getGroup=function(e){if(v.groupBarrel[e])return v.groupBarrel[e]},this.setGroupName=function(e,t){v.groupBarrel[e]&&void 0!==t&&(v.groupBarrel[e].label=t),i()},this.setGroupMemberName=function(e,t,n){v.groupBarrel[e]&&v.groupBarrel[e].gather[t]&&void 0!==n&&(v.groupBarrel[e].gather[t].label=n),i()},this.delGroup=function(e){if(0==v.groupState){for(var t=v.useThis("mainPanel"),n=Object.keys(v.groupBarrel[e].gather),o=0;o<t.componentList.length;o++)~n.indexOf(t.componentList[o].id)&&(delete t.componentList[o].groupMember,delete t.componentList[o].groupId);delete v.groupBarrel[e],i()}},this.determineGroup=function(){var e;1==v.groupState&&(e=v.groupTemporaryContainer.groupId,v.groupBarrel[e]=v.groupTemporaryContainer,e=v.useThis("mainPanel"),v.groupState=!1,e.groupState=!1,v.groupTemporaryContainer=null),i()},this.listeningGroupChange=function(e){var t=s();return v.groupChangeCallback[t]=e,function(){delete v.groupChangeCallback[t]}},this.addPageEvent=function(e,t){try{if(!t||"string"!=typeof t)throw new Error("方法为必传数据，且需要以字符形式传入！");var n=s(),o=v.useThis("mainPanel");o.eventGather[n]={name:e,fun:t},c(o)}catch(e){console.log(e)}},this.upPageEvent=function(e,t){try{var n=v.useThis("mainPanel");n.eventGather[e]={name:t.name||n.eventGather[e].name,fun:t.fun||n.eventGather[e].fun},c(n)}catch(e){console.log(e)}},this.removePageEvent=function(e){try{var t=v.useThis("mainPanel");delete t.eventGather[e],c(t)}catch(e){console.log(e)}},this.addComponentEvent=function(n,o){try{if(!o||"string"!=typeof o)throw new Error("方法为必传数据，且需要以字符形式传入！");var r=s(),i=v.useThis("mainPanel");i.componentList.forEach(function(e,t){if(e.id==v.currentControlId)throw i.componentList[t].eventGather[r]={name:n,fun:o},c(i.componentList[t]),new Error(!0)})}catch(e){"true"!==e.message&&!0!==e.message&&console.error(e)}},this.upComponentEvent=function(n,o){try{var r=v.useThis("mainPanel");r.componentList.forEach(function(e,t){if(e.id==v.currentControlId)throw r.componentList[t].eventGather[n]={name:o.name||r.componentList[t].eventGather[n].name,fun:o.fun||r.componentList[t].eventGather[n].fun},c(r.componentList[t]),new Error(!0)}),c(r)}catch(e){"true"!==e.message&&!0!==e.message&&console.error(e)}},this.removeComponentEvent=function(n){try{var o=v.useThis("mainPanel");o.componentList.forEach(function(e,t){if(e.id==v.currentControlId)throw delete o.componentList[t].eventGather[n],c(o.componentList[t]),new Error(!0)})}catch(e){"true"!==e.message&&!0!==e.message&&console.error(e)}},this.bindComponentEvent=function(n,o,r){try{if(!~["click","dblclick"].indexOf(n))throw new Error("当前自定义事件绑定只开放了[click/单击,dblclick/双击]");var i=v.useThis("mainPanel");i.componentList.forEach(function(e,t){if(e.id==v.currentControlId)throw i.componentList[t].bindEvent[n]={funcId:o,paramet:r},c(i.componentList[t]),new Error(!0)})}catch(e){"true"!==e.message&&!0!==e.message&&console.error(e)}},this.removeBindComponentEvent=function(n){try{var o=v.useThis("mainPanel");o.componentList.forEach(function(e,t){if(e.id==v.currentControlId)throw delete o.componentList[t].bindEvent[n],c(o.componentList[t]),new Error(!0)})}catch(e){"true"!==e.message&&!0!==e.message&&console.error(e)}},this.listeningEventChange=function(e){var t=s();return v.eventChangeCallback[t]=e,function(){delete v.eventChangeCallback[t]}},this.rollBack=function(){0<=v.currentRecordIndex&&(e("rollBack"),v.currentRecordIndex--)},this.nextStep=function(){v.currentRecordIndex+1<v.modifyRecord.length&&(v.currentRecordIndex++,e("nextStep"))},this.savePhaseData=function(){v.modifyRecord=[],v.currentRecordIndex=-1;var e=v.useThis("mainPanel"),n=JSON.parse(JSON.stringify(v.groupBarrel)),o=e.componentList.map(function(e){return e.id});Object.keys(n).forEach(function(t){Object.keys(n[t].gather).forEach(function(e){~o.indexOf(e)||delete n[t].gather[e]})}),v.groupBarrel=n;try{return{groupBarrel:v.groupBarrel,elements:e.componentList,mainPanel:{freeStyle:e.freeStyle,eventGather:e.eventGather}}}catch(e){console.error(e)}finally{Object.keys(v.currentChangeCallback).forEach(function(e){v.currentChangeCallback[e](null,v.currentRecordIndex,v.modifyRecord)})}},this.resetFreePanel=function(e){v.reset(e),Object.keys(v.currentSwitchCallback).forEach(function(e){v.currentSwitchCallback[e](null)}),Object.keys(v.currentChangeCallback).forEach(function(e){v.currentChangeCallback[e](null,v.currentRecordIndex,v.modifyRecord)})}};